# Chronicae 서버 실행 가이드 (임시)

## 1. 요구 사항
- macOS 15 이상, Xcode 16 이상
- Chronicae 앱은 SwiftUI 기반이며, 동일한 네트워크의 Vision Pro/Safari에서 접속하도록 설계되었습니다.

## 2. 실행 방법
1. Xcode에서 `Chronicae.xcodeproj`를 열고 `Chronicae` 타깃을 실행합니다.
2. 앱이 실행되면 자동으로 경량 HTTP 서버가 기동됩니다. 기본 포트는 `8843` 이며, 현재 선택된 프로젝트와 노트가 서버 측 `Core Data` 저장소로 노출됩니다.
3. iMac과 동일한 네트워크에 있는 기기에서 Safari를 열고 다음 주소로 접속합니다.
   - 로컬 전용(같은 iMac): `http://localhost:8843`
   - 다른 기기(Vision Pro 등)에서 접근하려면 **설정 탭에서 "외부 접속 허용"을 켠 뒤**, `http://<iMac-호스트명>:8843` 또는 `http://<iMac-IP주소>:8843` 형태로 접속합니다.
   - macOS 방화벽을 사용 중이면 처음 실행 시 “Chronicae가 들어오는 연결을 허용하시겠습니까?” 알림이 표시됩니다. 반드시 **허용**을 선택해야 다른 기기에서 접근할 수 있습니다. 나중에 허용하려면 `시스템 설정 → 네트워크 → 방화벽 → 옵션`에서 `Chronicae` 항목을 허용으로 변경하세요.
   - 호스트명은 앱 대시보드의 “접속 URL” 카드에서 확인 가능합니다.
4. 기본 랜딩 페이지는 프로젝트와 노트를 나란히 보여주는 관리 뷰입니다. 여기서 새 노트를 만들고 내용을 수정하면 즉시 서버가 저장하고, 다른 기기나 macOS 앱에도 반영됩니다. `/api/status` 엔드포인트는 JSON 상태를 반환합니다.

### 다중 디바이스 노트 편집
1. macOS 앱의 **저장소 관리** 섹션에서 원하는 프로젝트를 선택합니다. 선택 시 서버 구성의 `projectId`가 갱신되고 SSE 스트림이 구독됩니다.
2. 다른 기기에서 `http://<iMac-IP>:8843`에 접속한 뒤 프로젝트 카드를 선택하면 해당 프로젝트의 노트 목록이 로드됩니다.
3. 새 노트를 만들거나 내용을 수정하면 REST API(`/api/projects/{projectId}/notes`)를 통해 서버에 저장되고, `note.created`/`note.updated` SSE 이벤트가 브로드캐스트됩니다. macOS 앱은 이벤트를 수신해 목록을 최신 상태로 유지합니다.
4. 여러 기기가 동시에 편집할 수 있지만, 현재는 버전 충돌 방지가 없으므로 동시에 같은 노트를 저장하지 않도록 주의하세요. (추후 `If-Match` 기반 충돌 감지를 도입 예정)

### 접근 제어 (토큰 인증)
1. macOS 앱 **설정 → 보안** 섹션에서 `액세스 토큰 생성`을 누르면 무작위 토큰이 생성되고 서버에 즉시 반영됩니다.
2. 같은 화면에서 `iCloud Drive에 토큰 파일 저장` 버튼을 누르면 `iCloud Drive/Chronicae/token.json`이 갱신됩니다. Vision Pro나 iPhone에서 Files 앱을 통해 이 파일을 열어 `token` 값을 복사하면 됩니다.
3. 웹 클라이언트는 첫 접속 시 토큰을 요구하며, 값을 입력하면 `localStorage`에 저장하여 이후 요청마다 `Authorization: Bearer <token>` 헤더를 자동으로 첨부합니다.
4. 토큰을 회수하려면 `토큰 비활성화`를 선택하세요. 서버 구성과 iCloud 파일이 함께 삭제되며, 새 토큰을 배포하기 전까지 모든 API 호출이 401을 반환합니다.

## 3. 설정 변경
- macOS 앱의 **설정** 탭에서 포트, 외부 접속 허용을 변경하면 서버가 자동으로 재시작됩니다.
- 외부 접속 허용을 켜면 서버가 전체 네트워크 인터페이스(0.0.0.0)로 바인딩됩니다. 방화벽이나 macOS 접근 권한을 별도로 허용해야 할 수 있습니다.

## 4. 현재 제한 사항
- Vision Pro 웹앱은 정적 HTML 프리뷰만 제공되며, 향후 React 기반 SPA로 대체할 예정입니다.
- 인증은 공유 토큰 방식만 제공됩니다. 토큰이 유출되면 동일 네트워크의 누구나 접근할 수 있으므로 주기적인 갱신과 방화벽 설정이 필요합니다.
- HTTPS, 인덱싱 파이프라인, AI 연동은 아직 준비 중입니다.
- 서버는 싱글 프로세스/싱글 스레드 수준의 간단한 HTTP 파서를 사용합니다. 대량 트래픽에는 적합하지 않습니다.

## 5. 다음 단계 권장 사항
1. Vapor 또는 SwiftNIO 기반의 정식 라우팅/미들웨어 스택 통합.
2. `/api` 사양에 맞춘 라우트/컨트롤러 구현과 파일 시스템 연동.
3. Vision Pro용 SPA 번들링 및 정적 자산 서빙 라우트 구성.
4. HTTPS/인증 추가 및 로그/메트릭 수집.
5. 다중 디바이스 동시 편집 충돌 감지 및 자동 저장 전략 개선.

이 문서는 임시 버전으로, 기능이 확장되면 내용을 갱신하세요.
