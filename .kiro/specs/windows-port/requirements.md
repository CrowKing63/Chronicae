# Windows 포팅 요구사항 문서

## 소개

Chronicae는 현재 macOS 및 Vision Pro를 위한 노트 관리 애플리케이션입니다. 이 프로젝트는 Swift/SwiftUI로 작성되었으며, Core Data를 사용하여 데이터를 저장하고, 내장 HTTP 서버를 통해 웹 클라이언트와 통신합니다. 

이 문서는 Chronicae를 Windows 플랫폼으로 포팅하기 위한 요구사항을 정의합니다. Windows 포팅은 기존 macOS 앱의 핵심 기능을 유지하면서, Windows 네이티브 기술 스택을 활용하여 재구현하는 것을 목표로 합니다.

## 요구사항

### 요구사항 1: 크로스 플랫폼 아키텍처 설계

**사용자 스토리:** 개발자로서, Windows와 macOS 간에 코드를 최대한 공유하면서도 각 플랫폼의 네이티브 경험을 제공하고 싶습니다.

#### 수락 기준

1. WHEN 아키텍처를 설계할 때 THEN 시스템은 플랫폼 독립적인 비즈니스 로직 계층과 플랫폼별 UI/인프라 계층으로 분리되어야 합니다
2. WHEN 기술 스택을 선택할 때 THEN Windows에서는 .NET/C# 또는 Electron/TypeScript 중 하나를 선택해야 합니다
3. IF .NET을 선택한다면 THEN WPF, WinUI 3, 또는 Avalonia UI 중 하나를 UI 프레임워크로 사용해야 합니다
4. IF Electron을 선택한다면 THEN React 또는 Vue.js를 UI 라이브러리로 사용해야 합니다
5. WHEN 데이터 저장소를 구현할 때 THEN SQLite 또는 다른 크로스 플랫폼 데이터베이스를 사용하여 Core Data를 대체해야 합니다

### 요구사항 2: 데이터 계층 마이그레이션

**사용자 스토리:** 사용자로서, macOS에서 생성한 노트와 프로젝트를 Windows 버전에서도 사용할 수 있어야 합니다.

#### 수락 기준

1. WHEN 데이터 모델을 구현할 때 THEN Project, Note, NoteVersion, BackupRecord, ExportJob 엔터티를 모두 지원해야 합니다
2. WHEN 데이터베이스 스키마를 생성할 때 THEN 기존 Core Data 모델과 동일한 관계와 속성을 유지해야 합니다
3. WHEN 데이터를 저장할 때 THEN UUID를 기본 키로 사용하고 ISO8601 형식으로 날짜를 저장해야 합니다
4. WHEN 노트를 업데이트할 때 THEN 자동으로 버전 스냅샷을 생성해야 합니다
5. IF 사용자가 macOS 백업 파일을 가져온다면 THEN Windows 버전에서 데이터를 복원할 수 있어야 합니다
6. WHEN 태그를 저장할 때 THEN JSON 배열 형식으로 직렬화해야 합니다
7. WHEN 노트 목록을 조회할 때 THEN 커서 기반 페이지네이션을 지원해야 합니다

### 요구사항 3: HTTP 서버 구현

**사용자 스토리:** 개발자로서, 웹 클라이언트와 통신하기 위한 REST API 서버를 Windows에서 실행하고 싶습니다.

#### 수락 기준

1. WHEN 서버를 시작할 때 THEN 지정된 포트(기본값 8843)에서 HTTP 요청을 수신해야 합니다
2. WHEN 서버 설정을 변경할 때 THEN 로컬 전용(127.0.0.1) 또는 외부 접속 허용(0.0.0.0) 모드를 선택할 수 있어야 합니다
3. WHEN API 요청을 처리할 때 THEN Bearer 토큰 기반 인증을 지원해야 합니다
4. WHEN 클라이언트가 `/api/projects` 엔드포인트를 호출할 때 THEN 프로젝트 목록을 JSON 형식으로 반환해야 합니다
5. WHEN 클라이언트가 `/api/projects/{id}/notes` 엔드포인트를 호출할 때 THEN 해당 프로젝트의 노트 목록을 반환해야 합니다
6. WHEN 클라이언트가 노트를 생성/수정/삭제할 때 THEN 적절한 HTTP 메서드(POST/PUT/DELETE)를 지원해야 합니다
7. WHEN 버전 충돌이 발생할 때 THEN 409 Conflict 상태 코드와 함께 현재 노트 정보를 반환해야 합니다
8. WHEN 서버가 실행 중일 때 THEN `/web-app` 경로에서 정적 웹 자산을 서빙해야 합니다

### 요구사항 4: Server-Sent Events (SSE) 구현

**사용자 스토리:** 사용자로서, 여러 기기에서 노트를 편집할 때 실시간으로 변경 사항이 동기화되기를 원합니다.

#### 수락 기준

1. WHEN 클라이언트가 `/api/events` 엔드포인트에 연결할 때 THEN SSE 스트림을 시작해야 합니다
2. WHEN 노트가 생성될 때 THEN `note.created` 이벤트를 모든 연결된 클라이언트에 브로드캐스트해야 합니다
3. WHEN 노트가 업데이트될 때 THEN `note.updated` 이벤트를 브로드캐스트해야 합니다
4. WHEN 노트가 삭제될 때 THEN `note.deleted` 이벤트를 브로드캐스트해야 합니다
5. WHEN 프로젝트가 전환될 때 THEN `project.switched` 이벤트를 브로드캐스트해야 합니다
6. WHEN 백업이 완료될 때 THEN `backup.completed` 이벤트를 브로드캐스트해야 합니다
7. WHEN 인덱싱 작업이 완료될 때 THEN `index.job.completed` 이벤트를 브로드캐스트해야 합니다
8. WHEN 클라이언트 연결이 끊어질 때 THEN 자동으로 재연결을 시도해야 합니다

### 요구사항 5: Windows 네이티브 UI 구현

**사용자 스토리:** Windows 사용자로서, Windows 디자인 가이드라인을 따르는 네이티브 앱 경험을 원합니다.

#### 수락 기준

1. WHEN 앱을 실행할 때 THEN Windows 11 스타일의 UI를 표시해야 합니다
2. WHEN 메인 윈도우를 열 때 THEN 사이드바, 콘텐츠 영역, 상세 뷰로 구성된 3단 레이아웃을 표시해야 합니다
3. WHEN 사이드바를 표시할 때 THEN 대시보드, 저장소 관리, 버전 기록, 설정 섹션을 포함해야 합니다
4. WHEN 대시보드를 표시할 때 THEN 서버 상태, 프로젝트 통계, 최근 백업 정보를 표시해야 합니다
5. WHEN 저장소 관리 섹션을 표시할 때 THEN 프로젝트 목록과 노트 목록을 표시해야 합니다
6. WHEN 노트를 선택할 때 THEN 마크다운 편집기를 표시해야 합니다
7. WHEN 설정 섹션을 표시할 때 THEN 포트, 외부 접속 허용, 토큰 관리 옵션을 제공해야 합니다
8. WHEN 시스템 트레이 아이콘을 클릭할 때 THEN 서버 시작/중지, 설정 열기 메뉴를 표시해야 합니다

### 요구사항 6: 검색 기능 구현

**사용자 스토리:** 사용자로서, 노트 제목, 내용, 태그를 기반으로 빠르게 검색하고 싶습니다.

#### 수락 기준

1. WHEN 검색 쿼리를 입력할 때 THEN 제목, 내용, 발췌문, 태그에서 대소문자 구분 없이 검색해야 합니다
2. WHEN 검색 결과를 표시할 때 THEN 관련성 점수와 함께 스니펫을 표시해야 합니다
3. WHEN `/api/search` 엔드포인트를 호출할 때 THEN keyword 또는 semantic 모드를 지원해야 합니다
4. WHEN 검색 결과를 정렬할 때 THEN 점수가 높은 순서로 정렬해야 합니다
5. IF 프로젝트 ID가 제공된다면 THEN 해당 프로젝트 내에서만 검색해야 합니다

### 요구사항 7: 백업 및 내보내기 기능

**사용자 스토리:** 사용자로서, 데이터를 안전하게 백업하고 다양한 형식으로 내보낼 수 있어야 합니다.

#### 수락 기준

1. WHEN 백업을 실행할 때 THEN 모든 프로젝트, 노트, 버전을 포함한 ZIP 파일을 생성해야 합니다
2. WHEN 백업이 완료될 때 THEN 백업 기록에 타임스탬프, 상태, 파일 경로를 저장해야 합니다
3. WHEN 백업 기록을 조회할 때 THEN 최신 순으로 정렬된 목록을 반환해야 합니다
4. WHEN 노트를 내보낼 때 THEN Markdown, PDF, TXT 형식을 지원해야 합니다
5. WHEN 프로젝트를 내보낼 때 THEN ZIP 또는 JSON 형식을 지원해야 합니다
6. WHEN 내보내기 작업을 큐에 추가할 때 THEN 작업 ID와 상태를 반환해야 합니다

### 요구사항 8: 버전 관리 시스템

**사용자 스토리:** 사용자로서, 노트의 이전 버전을 확인하고 필요시 복원할 수 있어야 합니다.

#### 수락 기준

1. WHEN 노트를 수정할 때 THEN 자동으로 새 버전 스냅샷을 생성해야 합니다
2. WHEN 버전 목록을 조회할 때 THEN 최신 순으로 정렬된 버전 목록을 반환해야 합니다
3. WHEN 특정 버전을 조회할 때 THEN 해당 시점의 제목, 내용, 발췌문을 반환해야 합니다
4. WHEN 버전을 복원할 때 THEN 해당 버전의 내용을 현재 노트에 적용하고 새 버전을 생성해야 합니다
5. WHEN 버전을 내보낼 때 THEN 해당 버전의 내용을 지정된 형식으로 내보내야 합니다
6. WHEN 노트를 삭제할 때 THEN 선택적으로 모든 버전을 함께 삭제할 수 있어야 합니다

### 요구사항 9: 설정 및 구성 관리

**사용자 스토리:** 사용자로서, 서버 설정을 쉽게 변경하고 보안 토큰을 관리하고 싶습니다.

#### 수락 기준

1. WHEN 포트 번호를 변경할 때 THEN 서버를 자동으로 재시작해야 합니다
2. WHEN 외부 접속 허용 설정을 변경할 때 THEN 서버를 자동으로 재시작해야 합니다
3. WHEN 액세스 토큰을 생성할 때 THEN 무작위 보안 토큰을 생성하고 저장해야 합니다
4. WHEN 토큰을 비활성화할 때 THEN 저장된 토큰을 삭제하고 모든 API 요청을 거부해야 합니다
5. WHEN 설정을 저장할 때 THEN Windows 사용자 프로필 디렉터리에 JSON 파일로 저장해야 합니다
6. WHEN 앱을 시작할 때 THEN 저장된 설정을 자동으로 로드해야 합니다
7. WHEN 활성 프로젝트를 변경할 때 THEN 설정에 저장하고 다음 실행 시 복원해야 합니다

### 요구사항 10: 시스템 통합

**사용자 스토리:** Windows 사용자로서, 시스템 트레이, 시작 프로그램 등록, 방화벽 설정 등 Windows 기능과 통합되기를 원합니다.

#### 수락 기준

1. WHEN 앱을 실행할 때 THEN 시스템 트레이에 아이콘을 표시해야 합니다
2. WHEN 메인 윈도우를 닫을 때 THEN 백그라운드에서 계속 실행되어야 합니다
3. WHEN 시스템 트레이 아이콘을 더블 클릭할 때 THEN 메인 윈도우를 표시해야 합니다
4. WHEN 설정에서 시작 프로그램 등록을 활성화할 때 THEN Windows 시작 시 자동으로 실행되어야 합니다
5. IF 외부 접속이 허용된다면 THEN Windows 방화벽 규칙 추가를 안내해야 합니다
6. WHEN 앱을 종료할 때 THEN 서버를 정상적으로 중지하고 모든 리소스를 해제해야 합니다
7. WHEN 로그를 기록할 때 THEN Windows 이벤트 로그 또는 파일 시스템에 저장해야 합니다

### 요구사항 11: 웹 클라이언트 호환성

**사용자 스토리:** 사용자로서, 기존 Vision Pro 웹 클라이언트를 Windows 서버에서도 사용할 수 있어야 합니다.

#### 수락 기준

1. WHEN 웹 클라이언트가 `/web-app` 경로에 접속할 때 THEN React 기반 SPA를 서빙해야 합니다
2. WHEN 정적 자산을 요청할 때 THEN 적절한 Content-Type 헤더와 함께 반환해야 합니다
3. WHEN 자산을 캐싱할 때 THEN ETag와 Cache-Control 헤더를 설정해야 합니다
4. WHEN Service Worker를 등록할 때 THEN 오프라인 지원을 위한 precache manifest를 제공해야 합니다
5. WHEN CORS 요청을 처리할 때 THEN 적절한 Access-Control 헤더를 설정해야 합니다
6. WHEN 웹 클라이언트가 API를 호출할 때 THEN 동일한 REST API 엔드포인트를 사용해야 합니다

### 요구사항 12: 에러 처리 및 로깅

**사용자 스토리:** 개발자로서, 문제 발생 시 디버깅을 위한 상세한 로그와 에러 정보를 확인하고 싶습니다.

#### 수락 기준

1. WHEN API 에러가 발생할 때 THEN 표준화된 JSON 에러 응답을 반환해야 합니다
2. WHEN 에러 응답을 생성할 때 THEN code, message, details 필드를 포함해야 합니다
3. WHEN 서버 에러가 발생할 때 THEN 로그 파일에 스택 트레이스를 기록해야 합니다
4. WHEN 클라이언트 에러(4xx)가 발생할 때 THEN 사용자에게 이해하기 쉬운 메시지를 표시해야 합니다
5. WHEN 서버 에러(5xx)가 발생할 때 THEN 일반적인 에러 메시지를 표시하고 상세 정보는 로그에 기록해야 합니다
6. WHEN 로그 레벨을 설정할 때 THEN Debug, Info, Warning, Error 레벨을 지원해야 합니다
7. WHEN 로그를 기록할 때 THEN 타임스탬프, 레벨, 카테고리, 메시지를 포함해야 합니다
