<Window x:Class="Chronicae.Desktop.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Chronicae.Desktop"
        xmlns:views="clr-namespace:Chronicae.Desktop.Views"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        mc:Ignorable="d"
        ui:WindowHelper.UseModernWindowStyle="True"
        Title="Chronicae" Height="720" Width="1080"
        MinHeight="600" MinWidth="900">
    
    <Window.Resources>
        <local:SectionTemplateSelector x:Key="SectionTemplateSelector">
            <local:SectionTemplateSelector.DefaultTemplate>
                <DataTemplate>
                    <Grid>
                        <TextBlock Text="Select a section from the sidebar" 
                                  HorizontalAlignment="Center" 
                                  VerticalAlignment="Center"
                                  FontSize="16"
                                  Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                    </Grid>
                </DataTemplate>
            </local:SectionTemplateSelector.DefaultTemplate>
            
            <local:SectionTemplateSelector.DashboardTemplate>
                <DataTemplate>
                    <views:DashboardView DataContext="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext}"/>
                </DataTemplate>
            </local:SectionTemplateSelector.DashboardTemplate>
            
            <local:SectionTemplateSelector.StorageManagementTemplate>
                <DataTemplate>
                    <views:StorageManagementView DataContext="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext}"/>
                </DataTemplate>
            </local:SectionTemplateSelector.StorageManagementTemplate>
            
            <local:SectionTemplateSelector.VersionHistoryTemplate>
                <DataTemplate>
                    <Grid Margin="24">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" 
                                  Text="Version History" 
                                  FontSize="24" 
                                  FontWeight="SemiBold" 
                                  Margin="0,0,0,24"/>
                        
                        <TextBlock Grid.Row="1" 
                                  Text="Version history features will be implemented in future tasks." 
                                  HorizontalAlignment="Center" 
                                  VerticalAlignment="Center"
                                  FontSize="14"
                                  Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                    </Grid>
                </DataTemplate>
            </local:SectionTemplateSelector.VersionHistoryTemplate>
            
            <local:SectionTemplateSelector.SettingsTemplate>
                <DataTemplate>
                    <views:SettingsView DataContext="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.SettingsViewModel}"/>
                </DataTemplate>
            </local:SectionTemplateSelector.SettingsTemplate>
        </local:SectionTemplateSelector>
        
        <!-- Value Converters -->
        <local:EqualityConverter x:Key="EqualityConverter"/>
    </Window.Resources>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200" MinWidth="150"/>
            <ColumnDefinition Width="300" MinWidth="250"/>
            <ColumnDefinition Width="*" MinWidth="400"/>
        </Grid.ColumnDefinitions>
        
        <!-- Sidebar -->
        <Border Grid.Column="0" 
                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- App Title -->
                <TextBlock Grid.Row="0" 
                          Text="Chronicae" 
                          FontSize="18" 
                          FontWeight="SemiBold"
                          Margin="16,16,16,8"
                          Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                
                <!-- Navigation Sections -->
                <ListBox Grid.Row="1" 
                         ItemsSource="{Binding Sections}"
                         SelectedItem="{Binding SelectedSection}"
                         Background="Transparent"
                         BorderThickness="0"
                         Margin="8,0">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem" BasedOn="{StaticResource DefaultListBoxItemStyle}">
                            <Setter Property="Padding" Value="12,8"/>
                            <Setter Property="Margin" Value="0,2"/>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>
                
                <!-- Status Bar -->
                <Border Grid.Row="2" 
                        Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                        BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                        BorderThickness="0,1,0,0"
                        Padding="12,8">
                    <StackPanel>
                        <TextBlock Text="{Binding StatusMessage}" 
                                  FontSize="11"
                                  Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                  TextTrimming="CharacterEllipsis"/>
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <Ellipse Width="8" Height="8" Margin="0,0,6,0">
                                <Ellipse.Style>
                                    <Style TargetType="Ellipse">
                                        <Setter Property="Fill" Value="Gray"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ServerStatus}" Value="Running">
                                                <Setter Property="Fill" Value="Green"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding ServerStatus}" Value="Starting">
                                                <Setter Property="Fill" Value="Orange"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding ServerStatus}" Value="Error">
                                                <Setter Property="Fill" Value="Red"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Ellipse.Style>
                            </Ellipse>
                            <TextBlock Text="{Binding ServerStatus}" 
                                      FontSize="11"
                                      Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
        
        <!-- Content List (Projects/Notes) -->
        <Border Grid.Column="1" 
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- Search Box -->
                <ui:AutoSuggestBox Grid.Row="0"
                                  PlaceholderText="Search notes..."
                                  Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                                  Margin="12,12,12,8"/>
                
                <!-- Project Selector -->
                <ComboBox Grid.Row="1"
                         ItemsSource="{Binding Projects}"
                         SelectedItem="{Binding SelectedProject}"
                         DisplayMemberPath="Name"
                         Margin="12,0,12,8"
                         ui:ControlHelper.PlaceholderText="Select Project"/>
                
                <!-- Notes List -->
                <ListBox Grid.Row="2" 
                         ItemsSource="{Binding Notes}"
                         SelectedItem="{Binding SelectedNote}"
                         Background="Transparent"
                         BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="12,8" 
                                   Background="Transparent"
                                   BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                   BorderThickness="0,0,0,1">
                                <StackPanel>
                                    <TextBlock Text="{Binding Title}" 
                                              FontWeight="SemiBold"
                                              FontSize="14"
                                              TextTrimming="CharacterEllipsis"
                                              Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                                    <TextBlock Text="{Binding Excerpt}" 
                                              FontSize="12"
                                              Margin="0,4,0,0"
                                              TextTrimming="CharacterEllipsis"
                                              TextWrapping="Wrap"
                                              MaxHeight="40"
                                              Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                    <TextBlock Text="{Binding UpdatedAt, StringFormat='Updated: {0:MMM dd, yyyy}'}" 
                                              FontSize="10"
                                              Margin="0,4,0,0"
                                              Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem" BasedOn="{StaticResource DefaultListBoxItemStyle}">
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>
            </Grid>
        </Border>
        
        <!-- Detail View -->
        <Grid Grid.Column="2" Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
            <ContentControl Content="{Binding SelectedSection}"
                           ContentTemplateSelector="{StaticResource SectionTemplateSelector}"/>
        </Grid>
    </Grid>
</Window>
